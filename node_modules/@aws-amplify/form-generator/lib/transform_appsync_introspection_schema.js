import os from 'os';
import { getGenericFromDataStore, } from '@aws-amplify/codegen-ui';
import { parse } from 'graphql';
import * as graphqlCodegen from '@graphql-codegen/core';
import * as appsync from '@aws-amplify/appsync-modelgen-plugin';
import { DefaultDirectives } from '@aws-amplify/graphql-directives';
/**
 * Transforms an AppSync introspection schema for use in form generation
 */
export const transformIntrospectionSchema = async (modelIntrospectionSchema) => {
    const result = await appsync.preset.buildGeneratesSection({
        baseOutputDir: './',
        schema: parse(modelIntrospectionSchema),
        config: {
            directives: DefaultDirectives.map((directive) => directive.definition).join(os.EOL),
            isTimestampFieldsAdded: true,
            emitAuthProvider: true,
            generateIndexRules: true,
            handleListNullabilityTransparently: true,
            usePipelinedTransformer: true,
            transformerVersion: 2,
            respectPrimaryKeyAttributesOnConnectionField: true,
            improvePluralization: false,
            generateModelsForLazyLoadAndCustomSelectionSet: false,
            target: 'introspection',
            overrideOutputDir: './',
        },
        documents: [],
        pluginMap: {},
        presetConfig: {
            overrideOutputDir: null,
            target: 'typescript',
        },
        plugins: [],
    });
    const results = result.map((cfg) => {
        return graphqlCodegen.codegen({
            ...cfg,
            config: {
                ...cfg.config,
            },
            plugins: [
                {
                    appSyncLocalCodeGen: {},
                },
            ],
            pluginMap: {
                appSyncLocalCodeGen: appsync,
            },
        });
    });
    const [synced] = await Promise.all(results);
    return getGenericFromDataStore(JSON.parse(synced));
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhbnNmb3JtX2FwcHN5bmNfaW50cm9zcGVjdGlvbl9zY2hlbWEuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvdHJhbnNmb3JtX2FwcHN5bmNfaW50cm9zcGVjdGlvbl9zY2hlbWEudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE1BQU0sSUFBSSxDQUFDO0FBQ3BCLE9BQU8sRUFFTCx1QkFBdUIsR0FDeEIsTUFBTSx5QkFBeUIsQ0FBQztBQUNqQyxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBQ2hDLE9BQU8sS0FBSyxjQUFjLE1BQU0sdUJBQXVCLENBQUM7QUFDeEQsT0FBTyxLQUFLLE9BQU8sTUFBTSxzQ0FBc0MsQ0FBQztBQUNoRSxPQUFPLEVBQUUsaUJBQWlCLEVBQWEsTUFBTSxpQ0FBaUMsQ0FBQztBQUUvRTs7R0FFRztBQUNILE1BQU0sQ0FBQyxNQUFNLDRCQUE0QixHQUFHLEtBQUssRUFDL0Msd0JBQWdDLEVBQ0osRUFBRTtJQUM5QixNQUFNLE1BQU0sR0FBRyxNQUFNLE9BQU8sQ0FBQyxNQUFNLENBQUMscUJBQXFCLENBQUM7UUFDeEQsYUFBYSxFQUFFLElBQUk7UUFDbkIsTUFBTSxFQUFFLEtBQUssQ0FBQyx3QkFBd0IsQ0FBQztRQUN2QyxNQUFNLEVBQUU7WUFDTixVQUFVLEVBQUUsaUJBQWlCLENBQUMsR0FBRyxDQUMvQixDQUFDLFNBQW9CLEVBQUUsRUFBRSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQy9DLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUM7WUFDZCxzQkFBc0IsRUFBRSxJQUFJO1lBQzVCLGdCQUFnQixFQUFFLElBQUk7WUFDdEIsa0JBQWtCLEVBQUUsSUFBSTtZQUN4QixrQ0FBa0MsRUFBRSxJQUFJO1lBQ3hDLHVCQUF1QixFQUFFLElBQUk7WUFDN0Isa0JBQWtCLEVBQUUsQ0FBQztZQUNyQiw0Q0FBNEMsRUFBRSxJQUFJO1lBQ2xELG9CQUFvQixFQUFFLEtBQUs7WUFDM0IsOENBQThDLEVBQUUsS0FBSztZQUNyRCxNQUFNLEVBQUUsZUFBZTtZQUN2QixpQkFBaUIsRUFBRSxJQUFJO1NBQ3hCO1FBQ0QsU0FBUyxFQUFFLEVBQUU7UUFDYixTQUFTLEVBQUUsRUFBRTtRQUNiLFlBQVksRUFBRTtZQUNaLGlCQUFpQixFQUFFLElBQUk7WUFDdkIsTUFBTSxFQUFFLFlBQVk7U0FDckI7UUFDRCxPQUFPLEVBQUUsRUFBRTtLQUNaLENBQUMsQ0FBQztJQUNILE1BQU0sT0FBTyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRTtRQUNqQyxPQUFPLGNBQWMsQ0FBQyxPQUFPLENBQUM7WUFDNUIsR0FBRyxHQUFHO1lBQ04sTUFBTSxFQUFFO2dCQUNOLEdBQUcsR0FBRyxDQUFDLE1BQU07YUFDZDtZQUNELE9BQU8sRUFBRTtnQkFDUDtvQkFDRSxtQkFBbUIsRUFBRSxFQUFFO2lCQUN4QjthQUNGO1lBQ0QsU0FBUyxFQUFFO2dCQUNULG1CQUFtQixFQUFFLE9BQU87YUFDN0I7U0FDRixDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILE1BQU0sQ0FBQyxNQUFNLENBQUMsR0FBRyxNQUFNLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDNUMsT0FBTyx1QkFBdUIsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7QUFDckQsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IG9zIGZyb20gJ29zJztcbmltcG9ydCB7XG4gIEdlbmVyaWNEYXRhU2NoZW1hLFxuICBnZXRHZW5lcmljRnJvbURhdGFTdG9yZSxcbn0gZnJvbSAnQGF3cy1hbXBsaWZ5L2NvZGVnZW4tdWknO1xuaW1wb3J0IHsgcGFyc2UgfSBmcm9tICdncmFwaHFsJztcbmltcG9ydCAqIGFzIGdyYXBocWxDb2RlZ2VuIGZyb20gJ0BncmFwaHFsLWNvZGVnZW4vY29yZSc7XG5pbXBvcnQgKiBhcyBhcHBzeW5jIGZyb20gJ0Bhd3MtYW1wbGlmeS9hcHBzeW5jLW1vZGVsZ2VuLXBsdWdpbic7XG5pbXBvcnQgeyBEZWZhdWx0RGlyZWN0aXZlcywgRGlyZWN0aXZlIH0gZnJvbSAnQGF3cy1hbXBsaWZ5L2dyYXBocWwtZGlyZWN0aXZlcyc7XG5cbi8qKlxuICogVHJhbnNmb3JtcyBhbiBBcHBTeW5jIGludHJvc3BlY3Rpb24gc2NoZW1hIGZvciB1c2UgaW4gZm9ybSBnZW5lcmF0aW9uXG4gKi9cbmV4cG9ydCBjb25zdCB0cmFuc2Zvcm1JbnRyb3NwZWN0aW9uU2NoZW1hID0gYXN5bmMgKFxuICBtb2RlbEludHJvc3BlY3Rpb25TY2hlbWE6IHN0cmluZyxcbik6IFByb21pc2U8R2VuZXJpY0RhdGFTY2hlbWE+ID0+IHtcbiAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYXBwc3luYy5wcmVzZXQuYnVpbGRHZW5lcmF0ZXNTZWN0aW9uKHtcbiAgICBiYXNlT3V0cHV0RGlyOiAnLi8nLFxuICAgIHNjaGVtYTogcGFyc2UobW9kZWxJbnRyb3NwZWN0aW9uU2NoZW1hKSxcbiAgICBjb25maWc6IHtcbiAgICAgIGRpcmVjdGl2ZXM6IERlZmF1bHREaXJlY3RpdmVzLm1hcChcbiAgICAgICAgKGRpcmVjdGl2ZTogRGlyZWN0aXZlKSA9PiBkaXJlY3RpdmUuZGVmaW5pdGlvbixcbiAgICAgICkuam9pbihvcy5FT0wpLFxuICAgICAgaXNUaW1lc3RhbXBGaWVsZHNBZGRlZDogdHJ1ZSxcbiAgICAgIGVtaXRBdXRoUHJvdmlkZXI6IHRydWUsXG4gICAgICBnZW5lcmF0ZUluZGV4UnVsZXM6IHRydWUsXG4gICAgICBoYW5kbGVMaXN0TnVsbGFiaWxpdHlUcmFuc3BhcmVudGx5OiB0cnVlLFxuICAgICAgdXNlUGlwZWxpbmVkVHJhbnNmb3JtZXI6IHRydWUsXG4gICAgICB0cmFuc2Zvcm1lclZlcnNpb246IDIsXG4gICAgICByZXNwZWN0UHJpbWFyeUtleUF0dHJpYnV0ZXNPbkNvbm5lY3Rpb25GaWVsZDogdHJ1ZSxcbiAgICAgIGltcHJvdmVQbHVyYWxpemF0aW9uOiBmYWxzZSxcbiAgICAgIGdlbmVyYXRlTW9kZWxzRm9yTGF6eUxvYWRBbmRDdXN0b21TZWxlY3Rpb25TZXQ6IGZhbHNlLFxuICAgICAgdGFyZ2V0OiAnaW50cm9zcGVjdGlvbicsXG4gICAgICBvdmVycmlkZU91dHB1dERpcjogJy4vJyxcbiAgICB9LFxuICAgIGRvY3VtZW50czogW10sXG4gICAgcGx1Z2luTWFwOiB7fSxcbiAgICBwcmVzZXRDb25maWc6IHtcbiAgICAgIG92ZXJyaWRlT3V0cHV0RGlyOiBudWxsLFxuICAgICAgdGFyZ2V0OiAndHlwZXNjcmlwdCcsXG4gICAgfSxcbiAgICBwbHVnaW5zOiBbXSxcbiAgfSk7XG4gIGNvbnN0IHJlc3VsdHMgPSByZXN1bHQubWFwKChjZmcpID0+IHtcbiAgICByZXR1cm4gZ3JhcGhxbENvZGVnZW4uY29kZWdlbih7XG4gICAgICAuLi5jZmcsXG4gICAgICBjb25maWc6IHtcbiAgICAgICAgLi4uY2ZnLmNvbmZpZyxcbiAgICAgIH0sXG4gICAgICBwbHVnaW5zOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBhcHBTeW5jTG9jYWxDb2RlR2VuOiB7fSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICBwbHVnaW5NYXA6IHtcbiAgICAgICAgYXBwU3luY0xvY2FsQ29kZUdlbjogYXBwc3luYyxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0pO1xuXG4gIGNvbnN0IFtzeW5jZWRdID0gYXdhaXQgUHJvbWlzZS5hbGwocmVzdWx0cyk7XG4gIHJldHVybiBnZXRHZW5lcmljRnJvbURhdGFTdG9yZShKU09OLnBhcnNlKHN5bmNlZCkpO1xufTtcbiJdfQ==